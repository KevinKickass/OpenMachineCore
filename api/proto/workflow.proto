syntax = "proto3";

package openmachinecore.v1;

option go_package = "github.com/KevinKickass/OpenMachineCore/api/proto";

import "api/proto/common.proto";

service WorkflowService {
  rpc StreamExecutionStatus(ExecutionStreamRequest) returns (stream ExecutionStatus);
  rpc GetExecutionStatus(ExecutionStatusRequest) returns (ExecutionStatusResponse);
}

message ExecutionStreamRequest {
  string execution_id = 1;
}

message ExecutionStatusRequest {
  string execution_id = 1;
}

message ExecutionStatus {
  string execution_id = 1;
  string event_type = 2;
  string payload = 3;
  int64 timestamp = 4;
}

message ExecutionStatusResponse {
  string execution_id = 1;
  string workflow_id = 2;
  string status = 3;
  int32 current_step = 4;
  string current_step_id = 9;       // Hierarchical step ID, e.g., "main:S10:sub_pick:S20"
  string error = 5;
  repeated StepStatus steps = 6;
  int64 started_at = 7;
  int64 completed_at = 8;
  repeated CallFrame call_stack = 10; // Current execution call stack
}

message StepStatus {
  int32 step_index = 1;
  string step_name = 2;
  string status = 3;
  string output = 4;
  string error = 5;
  string hierarchical_step_id = 6; // Full hierarchical step ID, e.g., "main:S10:sub_pick:S20"
  int32 depth = 7;                 // Nesting depth in call stack
}

message CallFrame {
  string workflow_id = 1;
  string program_name = 2;
  string step_number = 3;
}
